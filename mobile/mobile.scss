// Grid layout for mobile: stacked layout
.topic-cards-list--grid {
  .topic-list-body {
    gap: var(--space-4);
  }
}

// List layout for mobile: row layout adapted for mobile
.topic-cards-list--list {
  .topic-list-body {
    gap: var(--space-3);
  }
}

.topic-card--grid {
  flex-direction: column;
  max-height: none;
  max-width: none;
  padding: 0;
  gap: 0;

  &:has(.topic-card__thumbnail) {
    max-height: unset;
  }

  .pull-left,
  .topic-item-stats,
  .topic-item-metadata {
    display: none !important;
  }

  .topic-list-data {
    max-width: none;
  }

  .topic-card__thumbnail {
    text-align: center;
    margin-bottom: var(--space-3);

    .main-thumbnail {
      display: block;
      width: 100%;
      height: auto;
      max-height: #{$grid-thumbnail-max-height}px;
      object-fit: cover;

      // Grid: thumbnail on top, round top corners only
      border-top-left-radius: var(--topic-cards-border-radius);
      border-top-right-radius: var(--topic-cards-border-radius);
      background: var(--primary-low);
    }

    .thumbnail-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      aspect-ratio: 16 / 9;
      max-height: #{$grid-thumbnail-max-height}px;
      border-top-left-radius: var(--topic-cards-border-radius);
      border-top-right-radius: var(--topic-cards-border-radius);

      .d-icon {
        color: var(--primary-medium);
        font-size: var(--font-up-2);
      }
    }
  }

  .main-link {
    display: grid;
    grid-template-areas:
      "title title"
      "excerpt excerpt"
      "tags tags"
      "byline byline"
      "actions actions"
      "metadata metadata";
    grid-template-rows: auto auto auto auto auto 1fr;
    width: 100%;
    padding: var(--space-3) var(--space-5) !important;
    gap: var(--space-2) 0;

    &:first-child {
      grid-template-columns: auto 1fr;
    }

    .link-top-line {
      grid-area: title;
      display: grid;
      // Base: title only (when neither badges nor statuses exist)
      grid-template-columns: 1fr;
      grid-template-areas: "title";
      gap: 0;

      // Hide truly empty elements to prevent phantom grid tracks
      > .topic-post-badges:empty,
      > .topic-statuses:empty {
        display: none;
      }

      // Both badges and statuses present
      &:has(.topic-post-badges:not(:empty)):has(.topic-statuses:not(:empty)) {
        grid-template-columns: auto 1fr auto;
        grid-template-areas: "badges title statuses";
        gap: 0 var(--space-1);
      }

      // Only badges present (no statuses)
      &:has(.topic-post-badges:not(:empty)):not(:has(.topic-statuses:not(:empty))) {
        grid-template-columns: auto 1fr;
        grid-template-areas: "badges title";
        gap: 0 var(--space-1);
      }

      // Only statuses present (no badges)
      &:has(.topic-statuses:not(:empty)):not(:has(.topic-post-badges:not(:empty))) {
        grid-template-columns: 1fr auto;
        grid-template-areas: "title statuses";
        gap: 0 var(--space-1);
      }

      .topic-post-badges {
        grid-area: badges;
        white-space: nowrap;
      }

      .title {
        grid-area: title;
        min-width: 0;
      }

      .topic-statuses {
        grid-area: statuses;
        white-space: nowrap;
      }

      // Ensure featured link is properly positioned on mobile
      a.topic-featured-link {
        font-size: var(--font-down-2);
      }
    }

    // Stack badges and statuses on very narrow screens (only when both exist)
    @media (max-width: 340px) {
      .link-top-line:has(.topic-post-badges:not(:empty)):has(.topic-statuses:not(:empty)) {
        grid-template-columns: 1fr 1fr;
        grid-template-areas:
          "title title"
          "badges statuses";
        row-gap: var(--space-1);
      }
    }

    .link-bottom-line {
      display: none !important; // avoid duplicate tags/meta on mobile
    }
  }

  // Mobile-specific: reduce excerpt clamp on very narrow screens
  .topic-card__excerpt {
    -webkit-line-clamp: 2;
  }

  // Mobile-specific: allow action buttons to wrap/stack on narrow screens
  .topic-card__actions {
    .btn {
      flex: 1 1 auto;
      min-width: 120px;
    }
  }

  // Mobile-specific: compact metadata spacing
  .topic-card__metadata {
    font-size: var(--font-down-2);

    .right-aligned {
      gap: var(--space-2);
    }
  }
}

// List layout for mobile: row layout with compact spacing
.topic-card--list {
  flex-direction: row;
  max-height: none;
  padding: var(--space-2);
  gap: var(--space-3);

  &:has(.topic-card__thumbnail) {
    max-height: unset;
  }

  .pull-left,
  .topic-item-stats,
  .topic-item-metadata {
    display: none !important;
  }

  .topic-list-data {
    max-width: none;
  }

  .topic-card__thumbnail {
    flex: 0 0 35%;
    max-width: 150px;
    text-align: left;
    margin-bottom: 0;

    .main-thumbnail {
      display: block;
      width: 100%;
      height: 100%;
      max-height: 120px;
      object-fit: cover;

      // List: thumbnail on left, round left corners only
      border-top-left-radius: var(--topic-cards-border-radius);
      border-bottom-left-radius: var(--topic-cards-border-radius);
      background: var(--primary-low);
    }

    .thumbnail-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      max-height: 120px;
      aspect-ratio: 16 / 9;
      border-top-left-radius: var(--topic-cards-border-radius);
      border-bottom-left-radius: var(--topic-cards-border-radius);

      .d-icon {
        color: var(--primary-medium);
        font-size: var(--font-up-2);
      }
    }
  }

  .main-link {
    display: grid;
    grid-template-areas:
      "title title"
      "excerpt excerpt"
      "tags tags"
      "byline byline"
      "actions actions"
      "metadata metadata";
    grid-template-rows: auto auto auto auto auto 1fr;
    width: 100%;
    padding: 0 !important;
    gap: var(--space-1) 0;

    &:first-child {
      grid-template-columns: auto 1fr;
    }

    .link-top-line {
      grid-area: title;
      font-size: var(--font-down-1);
      display: grid;
      // Base: title only (when neither badges nor statuses exist)
      grid-template-columns: 1fr;
      grid-template-areas: "title";
      gap: 0;

      // Hide truly empty elements to prevent phantom grid tracks
      > .topic-post-badges:empty,
      > .topic-statuses:empty {
        display: none;
      }

      // Both badges and statuses present
      &:has(.topic-post-badges:not(:empty)):has(.topic-statuses:not(:empty)) {
        grid-template-columns: auto 1fr auto;
        grid-template-areas: "badges title statuses";
        gap: 0 var(--space-1);
      }

      // Only badges present (no statuses)
      &:has(.topic-post-badges:not(:empty)):not(:has(.topic-statuses:not(:empty))) {
        grid-template-columns: auto 1fr;
        grid-template-areas: "badges title";
        gap: 0 var(--space-1);
      }

      // Only statuses present (no badges)
      &:has(.topic-statuses:not(:empty)):not(:has(.topic-post-badges:not(:empty))) {
        grid-template-columns: 1fr auto;
        grid-template-areas: "title statuses";
        gap: 0 var(--space-1);
      }

      .topic-post-badges {
        grid-area: badges;
        white-space: nowrap;
      }

      .title {
        grid-area: title;
        min-width: 0;
      }

      .topic-statuses {
        grid-area: statuses;
        white-space: nowrap;
      }

      // Ensure featured link is properly positioned on mobile list layout
      a.topic-featured-link {
        font-size: var(--font-down-2);
      }
    }

    // Stack badges and statuses on very narrow screens (only when both exist)
    @media (max-width: 340px) {
      .link-top-line:has(.topic-post-badges:not(:empty)):has(.topic-statuses:not(:empty)) {
        grid-template-columns: 1fr 1fr;
        grid-template-areas:
          "title title"
          "badges statuses";
        row-gap: var(--space-1);
      }
    }

    .link-bottom-line {
      display: none !important;
    }
  }

  .topic-card__excerpt {
    font-size: var(--font-down-1);
  }

  .topic-card__metadata {
    font-size: var(--font-down-2);
  }

  .topic-card__byline {
    font-size: var(--font-down-2);
  }

  .topic-card__op {
    font-size: var(--font-down-2);
  }
}

// Overflow safety tweaks for mobile
.topic-card {
  // Ensure grid area can shrink inside the flex card
  .main-link { min-width: 0; }

  .topic-card__metadata {
    min-width: 0;

    // Allow action items to wrap on narrow screens instead of overflowing
    .right-aligned {
      flex-wrap: wrap;
      gap: var(--space-2);
      min-width: 0;
    }

    .item {
      flex: 0 1 auto;
      min-width: 0;
    }
  }

  // Extra safety for very long words/URLs
  .title,
  .topic-card__excerpt-text {
    word-break: break-word;
    overflow-wrap: anywhere;
  }
}

